<!DOCTYPE html> <!-- checkpoint -->
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Content Management | UniLearn</title>
    <link rel="icon" type="image/svg+xml" href="/images/e-learning.svg">
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://cdn.quilljs.com/1.3.6/quill.snow.css" rel="stylesheet">
    <script src="https://cdn.quilljs.com/1.3.6/quill.js"></script>
    <style>
        body { font-family: 'Poppins', sans-serif; }
        .form-toggle-btn.active {
            background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);
            color: white;
            box-shadow: 0 4px 14px rgba(59, 130, 246, 0.4);
        }
        .content-item {
            transition: all 0.2s ease;
        }
        .content-item:hover {
            transform: translateX(4px);
        }
        /* Drag & Drop Styles */
        .content-item[draggable="true"] {
            cursor: grab;
        }
        .content-item[draggable="true"]:active {
            cursor: grabbing;
        }
        .content-item.dragging {
            opacity: 0.5;
            transform: scale(0.95);
        }
        .drag-handle {
            cursor: grab;
        }
        .drag-handle:active {
            cursor: grabbing;
        }
        .ql-container {
            border-radius: 0 0 12px 12px;
            min-height: 120px;
        }
        .ql-toolbar {
            border-radius: 12px 12px 0 0;
            background: #f8fafc;
        }
        .dark .ql-toolbar {
            background: #374151;
            border-color: #4b5563;
        }
        .dark .ql-container {
            border-color: #4b5563;
        }
        .dark .ql-editor {
            color: #e5e7eb;
        }
    </style>
    <script src="/js/darkmode.js"></script>
    <script>
        tailwind.config = {
            darkMode: 'class'
        }
    </script>
    <link rel="stylesheet" href="/css/darkmode-improved.css">
</head>
<body class="transition-colors duration-300 bg-gradient-to-br from-gray-50 to-gray-100 dark:from-gray-900 dark:to-gray-800 min-h-screen">
    <%- include('../partials/header') %>
    
    <div class="max-w-7xl mx-auto px-4 py-8">
        <!-- Back Button -->
        <div class="mb-6">
            <a href="/teacher" class="inline-flex items-center gap-2 text-gray-600 dark:text-gray-400 hover:text-blue-600 dark:hover:text-blue-400 transition-colors group">
                <i class="fas fa-arrow-left text-sm group-hover:-translate-x-1 transition-transform"></i>
                <span class="text-sm font-medium">Back to Dashboard</span>
            </a>
        </div>

        <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
            <!-- Left Sidebar - Course Info & Content List -->
            <div class="lg:col-span-1 space-y-6">
                <!-- Course Info Card -->
                <div class="bg-white dark:bg-gray-800 rounded-2xl shadow-sm border border-gray-100 dark:border-gray-700 overflow-hidden">
                    <div class="bg-gradient-to-r from-blue-500 to-indigo-600 p-5">
                        <div class="flex items-center gap-3 mb-3">
                            <div class="w-10 h-10 rounded-xl bg-white/20 flex items-center justify-center">
                                <i class="fas fa-graduation-cap text-white text-lg"></i>
                            </div>
                            <span class="text-white/80 text-sm font-medium">Current Course</span>
                        </div>
                        <h2 class="text-xl font-bold text-white" id="course-title">Loading...</h2>
                        <p class="text-white/70 text-sm mt-2 line-clamp-2" id="course-description">Loading course details...</p>
                    </div>
                </div>

                <!-- Existing Content Card -->
                <div class="bg-white dark:bg-gray-800 rounded-2xl shadow-sm border border-gray-100 dark:border-gray-700 p-5">
                    <div class="flex items-center justify-between mb-2">
                        <h3 class="text-lg font-semibold text-gray-800 dark:text-gray-200">Existing Content</h3>
                        <span class="text-xs text-gray-500 dark:text-gray-400 bg-gray-100 dark:bg-gray-700 px-2 py-1 rounded-full" id="content-count">0 items</span>
                    </div>
                    <p class="text-xs text-gray-400 dark:text-gray-500 mb-4 flex items-center gap-1">
                        <i class="fas fa-grip-vertical"></i>
                        <span>Drag items to reorder</span>
                    </p>
                    <div class="max-h-[400px] overflow-y-auto pr-2 space-y-2">
                        <ul id="content-list" class="space-y-2">
                            <li class="text-gray-500 text-sm py-4 text-center">Loading content...</li>
                        </ul>
                    </div>
                </div>
            </div>

            <!-- Right Panel - Forms -->
            <div class="lg:col-span-2">
                <div class="bg-white dark:bg-gray-800 rounded-2xl shadow-sm border border-gray-100 dark:border-gray-700 p-6">
                    <!-- Form Toggle Buttons -->
                    <div class="flex gap-3 mb-6">
                        <button id="show-lesson-form-btn" class="form-toggle-btn flex-1 px-5 py-3 rounded-xl font-medium flex items-center justify-center gap-2 transition-all active">
                            <i class="fas fa-book-open"></i> Add New Lesson
                        </button>
                        <button id="show-quiz-form-btn" class="form-toggle-btn flex-1 px-5 py-3 rounded-xl font-medium text-gray-600 dark:text-gray-300 bg-gray-100 dark:bg-gray-700 hover:bg-gray-200 dark:hover:bg-gray-600 flex items-center justify-center gap-2 transition-all">
                            <i class="fas fa-puzzle-piece"></i> Add New Quiz
                        </button>
                    </div>

                    <!-- Lesson Form -->
                    <form id="lesson-form" class="space-y-5">
                        <div class="flex items-center gap-3 mb-6">
                            <div class="w-10 h-10 rounded-xl bg-blue-100 dark:bg-blue-900/30 flex items-center justify-center">
                                <i class="fas fa-book-open text-blue-600 dark:text-blue-400"></i>
                            </div>
                            <h3 id="lesson-form-title" class="text-xl font-bold text-gray-800 dark:text-gray-200">Add a New Lesson</h3>
                        </div>
                        
                        <input type="hidden" id="form-course-id">

                        <div>
                            <label for="lesson-title" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Lesson Title</label>
                            <input type="text" id="lesson-title" required placeholder="Enter lesson title..." class="w-full px-4 py-2.5 border border-gray-200 dark:border-gray-600 rounded-xl focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:text-gray-100">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Video (Optional)</label>

                            <!-- Video source selection - Cloud, Local, and YouTube options -->
                            <div class="grid grid-cols-3 gap-3 mb-4">
                                <label class="relative cursor-pointer">
                                    <input type="radio" name="video-source" value="upload" id="video-source-upload" checked class="peer sr-only">
                                    <div class="p-4 rounded-xl border-2 border-gray-200 dark:border-gray-600 peer-checked:border-blue-500 peer-checked:bg-blue-50 dark:peer-checked:bg-blue-900/20 transition-all h-full">
                                        <div class="flex items-center gap-3">
                                            <div class="w-10 h-10 rounded-lg bg-blue-100 dark:bg-blue-900/30 flex items-center justify-center">
                                                <i class="fas fa-cloud-upload-alt text-blue-600 dark:text-blue-400"></i>
                                            </div>
                                            <div>
                                                <p class="font-medium text-gray-800 dark:text-gray-200">Upload to Cloud</p>
                                                <p class="text-xs text-gray-500 dark:text-gray-400">Cloudinary CDN</p>
                                            </div>
                                        </div>
                                    </div>
                                </label>
                                <label class="relative cursor-pointer">
                                    <input type="radio" name="video-source" value="local" id="video-source-local" class="peer sr-only">
                                    <div class="p-4 rounded-xl border-2 border-gray-200 dark:border-gray-600 peer-checked:border-green-500 peer-checked:bg-green-50 dark:peer-checked:bg-green-900/20 transition-all h-full">
                                        <div class="flex items-center gap-3">
                                            <div class="w-10 h-10 rounded-lg bg-green-100 dark:bg-green-900/30 flex items-center justify-center">
                                                <i class="fas fa-server text-green-600 dark:text-green-400"></i>
                                            </div>
                                            <div>
                                                <p class="font-medium text-gray-800 dark:text-gray-200">Upload Local</p>
                                                <p class="text-xs text-gray-500 dark:text-gray-400">Unlimited size • Server storage</p>
                                            </div>
                                        </div>
                                    </div>
                                </label>
                                <label class="relative cursor-pointer">
                                    <input type="radio" name="video-source" value="youtube" id="video-source-youtube" class="peer sr-only">
                                    <div class="p-4 rounded-xl border-2 border-gray-200 dark:border-gray-600 peer-checked:border-red-500 peer-checked:bg-red-50 dark:peer-checked:bg-red-900/20 transition-all h-full">
                                        <div class="flex items-center gap-3">
                                            <div class="w-10 h-10 rounded-lg bg-red-100 dark:bg-red-900/30 flex items-center justify-center">
                                                <i class="fab fa-youtube text-red-600 dark:text-red-400"></i>
                                            </div>
                                            <div>
                                                <p class="font-medium text-gray-800 dark:text-gray-200">YouTube Link</p>
                                                <p class="text-xs text-gray-500 dark:text-gray-400">Paste video URL</p>
                                            </div>
                                        </div>
                                    </div>
                                </label>
                            </div>

                            <!-- File Upload Input (Cloud) -->
                            <div id="video-file-input">
                                <div class="border-2 border-dashed border-blue-200 dark:border-blue-800 rounded-xl p-6 text-center hover:border-blue-400 dark:hover:border-blue-600 transition-colors bg-blue-50/50 dark:bg-blue-900/10">
                                    <input type="file" id="lesson-video-file" accept="video/*" class="hidden">
                                    <div class="mb-3">
                                        <div class="w-12 h-12 rounded-full bg-blue-100 dark:bg-blue-900/30 flex items-center justify-center mx-auto">
                                            <i class="fas fa-cloud-upload-alt text-blue-600 dark:text-blue-400 text-xl"></i>
                                        </div>
                                    </div>
                                    <p class="text-sm text-gray-600 dark:text-gray-400 mb-2">Drag & drop your video here or</p>
                                    <button type="button" id="select-video-btn" class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 text-sm font-medium transition-colors">
                                        <i class="fas fa-folder-open mr-2"></i>Browse Files
                                    </button>
                                    <p class="mt-2 text-xs text-gray-500 dark:text-gray-400">MP4, WebM, MOV supported</p>
                                </div>
                                <div id="selected-file-info" class="hidden mt-3 p-3 bg-gray-50 dark:bg-gray-700 rounded-lg flex items-center justify-between">
                                    <div class="flex items-center gap-3">
                                        <i class="fas fa-video text-blue-500"></i>
                                        <span id="selected-file-name" class="text-sm text-gray-700 dark:text-gray-300"></span>
                                    </div>
                                    <button type="button" id="upload-video-btn" class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 text-sm font-medium">
                                        <i class="fas fa-upload mr-2"></i>Upload
                                    </button>
                                </div>
                                <div id="upload-progress" class="hidden mt-3">
                                    <div class="flex items-center gap-3 p-3 bg-blue-50 dark:bg-blue-900/20 rounded-lg">
                                        <i class="fas fa-spinner fa-spin text-blue-600"></i>
                                        <span id="upload-progress-text" class="text-sm text-blue-700 dark:text-blue-300">Uploading to cloud...</span>
                                    </div>
                                </div>
                                <div id="upload-success" class="hidden mt-3">
                                    <div class="flex items-center gap-3 p-3 bg-green-50 dark:bg-green-900/20 rounded-lg">
                                        <i class="fas fa-check-circle text-green-600"></i>
                                        <span class="text-sm text-green-700 dark:text-green-300">Video uploaded successfully!</span>
                                    </div>
                                </div>
                            </div>

                            <!-- File Upload Input (Local Server) -->
                            <div id="video-local-input" class="hidden">
                                <div class="border-2 border-dashed border-green-200 dark:border-green-800 rounded-xl p-6 text-center hover:border-green-400 dark:hover:border-green-600 transition-colors bg-green-50/50 dark:bg-green-900/10">
                                    <input type="file" id="lesson-video-local-file" accept="video/*" class="hidden">
                                    <div class="mb-3">
                                        <div class="w-12 h-12 rounded-full bg-green-100 dark:bg-green-900/30 flex items-center justify-center mx-auto">
                                            <i class="fas fa-server text-green-600 dark:text-green-400 text-xl"></i>
                                        </div>
                                    </div>
                                    <p class="text-sm text-gray-600 dark:text-gray-400 mb-2">Drag & drop your video here or</p>
                                    <button type="button" id="select-local-video-btn" class="px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 text-sm font-medium transition-colors">
                                        <i class="fas fa-folder-open mr-2"></i>Browse Files
                                    </button>
                                    <p class="mt-2 text-xs text-gray-500 dark:text-gray-400">Unlimited size • Stored on your server</p>
                                </div>
                                <div id="selected-local-file-info" class="hidden mt-3 p-3 bg-gray-50 dark:bg-gray-700 rounded-lg flex items-center justify-between">
                                    <div class="flex items-center gap-3">
                                        <i class="fas fa-video text-green-500"></i>
                                        <span id="selected-local-file-name" class="text-sm text-gray-700 dark:text-gray-300"></span>
                                    </div>
                                    <button type="button" id="upload-video-local-btn" class="px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 text-sm font-medium">
                                        <i class="fas fa-upload mr-2"></i>Upload
                                    </button>
                                </div>
                                <div id="upload-local-progress" class="hidden mt-3">
                                    <div class="flex items-center gap-3 p-3 bg-green-50 dark:bg-green-900/20 rounded-lg">
                                        <i class="fas fa-spinner fa-spin text-green-600"></i>
                                        <span id="upload-local-progress-text" class="text-sm text-green-700 dark:text-green-300">Uploading to server...</span>
                                    </div>
                                </div>
                                <div id="upload-local-success" class="hidden mt-3">
                                    <div class="flex items-center gap-3 p-3 bg-green-50 dark:bg-green-900/20 rounded-lg">
                                        <i class="fas fa-check-circle text-green-600"></i>
                                        <span class="text-sm text-green-700 dark:text-green-300">Video uploaded to server successfully!</span>
                                    </div>
                                </div>
                            </div>

                            <!-- YouTube URL Input -->
                            <div id="video-youtube-input" class="hidden">
                                <div class="border-2 border-dashed border-red-200 dark:border-red-800 rounded-xl p-6 bg-red-50/50 dark:bg-red-900/10">
                                    <div class="flex items-center gap-3 mb-4">
                                        <div class="w-12 h-12 rounded-full bg-red-100 dark:bg-red-900/30 flex items-center justify-center">
                                            <i class="fab fa-youtube text-red-600 dark:text-red-400 text-2xl"></i>
                                        </div>
                                        <div>
                                            <p class="font-medium text-gray-800 dark:text-gray-200">YouTube Video</p>
                                            <p class="text-xs text-gray-500 dark:text-gray-400">Paste your YouTube video link below</p>
                                        </div>
                                    </div>
                                    <div class="relative">
                                        <input type="text" id="youtube-url-input" placeholder="https://www.youtube.com/watch?v=..." class="w-full px-4 py-3 pl-12 border border-red-200 dark:border-red-700 rounded-xl focus:outline-none focus:ring-2 focus:ring-red-500 focus:border-red-500 dark:bg-gray-700 dark:text-gray-100">
                                        <i class="fas fa-link absolute left-4 top-1/2 -translate-y-1/2 text-gray-400"></i>
                                    </div>
                                    <div id="youtube-preview" class="hidden mt-4">
                                        <p class="text-sm text-gray-600 dark:text-gray-400 mb-2">Preview:</p>
                                        <div class="aspect-video bg-gray-900 rounded-lg overflow-hidden">
                                            <iframe id="youtube-preview-iframe" class="w-full h-full" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
                                        </div>
                                    </div>
                                    <p class="mt-3 text-xs text-gray-500 dark:text-gray-400">
                                        <i class="fas fa-info-circle mr-1"></i>
                                        Supported formats: youtube.com/watch?v=..., youtu.be/..., youtube.com/embed/...
                                    </p>
                                </div>
                            </div>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Lesson Content (Notes, Code...)</label>
                            <div id="editor-container" class="border border-gray-200 dark:border-gray-600 rounded-xl overflow-hidden"></div>
                        </div>

                        <div class="flex justify-end gap-3 pt-6 border-t border-gray-100 dark:border-gray-700">
                            <button type="button" id="cancel-lesson-edit-btn" class="px-5 py-2.5 bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300 rounded-xl hover:bg-gray-200 dark:hover:bg-gray-600 font-medium transition-colors">
                                Cancel
                            </button>
                            <button type="submit" class="px-6 py-2.5 bg-gradient-to-r from-blue-500 to-blue-600 text-white rounded-xl hover:from-blue-600 hover:to-blue-700 font-medium shadow-lg shadow-blue-500/25 transition-all">
                                <i class="fas fa-save mr-2"></i>Save Lesson
                            </button>
                        </div>
                    </form>

                    <!-- Quiz Form -->
                    <form id="quiz-form" class="hidden space-y-5">
                        <div class="flex items-center gap-3 mb-6">
                            <div class="w-10 h-10 rounded-xl bg-green-100 dark:bg-green-900/30 flex items-center justify-center">
                                <i class="fas fa-puzzle-piece text-green-600 dark:text-green-400"></i>
                            </div>
                            <h3 id="quiz-form-title" class="text-xl font-bold text-gray-800 dark:text-gray-200">Add a New Quiz</h3>
                        </div>
                        
                        <div class="space-y-4">
                            <div>
                                <label for="quiz-title" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Quiz Title</label>
                                <input type="text" id="quiz-title" required class="w-full px-4 py-2.5 border border-gray-200 dark:border-gray-600 rounded-xl focus:outline-none focus:ring-2 focus:ring-green-500 focus:border-green-500 dark:bg-gray-700 dark:text-gray-100">
                            </div>
                            <div>
                                <label for="quiz-description" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Description</label>
                                <textarea id="quiz-description" rows="3" class="w-full px-4 py-2.5 border border-gray-200 dark:border-gray-600 rounded-xl focus:outline-none focus:ring-2 focus:ring-green-500 focus:border-green-500 dark:bg-gray-700 dark:text-gray-100"></textarea>
                            </div>
                        </div>
                        
                        <div class="border-t border-gray-100 dark:border-gray-700 pt-6">
                            <div class="flex items-center justify-between mb-4">
                                <h4 class="text-lg font-semibold text-gray-800 dark:text-gray-200">Questions</h4>
                                <button type="button" id="add-question-btn" class="bg-gradient-to-r from-green-500 to-green-600 text-white px-4 py-2 rounded-xl hover:from-green-600 hover:to-green-700 flex items-center font-medium shadow-lg shadow-green-500/25 transition-all">
                                    <i class="fas fa-plus mr-2"></i> Add Question
                                </button>
                            </div>
                            <div id="questions-container" class="space-y-4"></div>
                        </div>
                        
                        <div class="flex justify-end gap-3 pt-6 border-t border-gray-100 dark:border-gray-700">
                            <button type="button" id="cancel-quiz-edit-btn" class="px-5 py-2.5 bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300 rounded-xl hover:bg-gray-200 dark:hover:bg-gray-600 font-medium transition-colors">
                                Cancel
                            </button>
                            <button type="submit" class="px-6 py-2.5 bg-gradient-to-r from-green-500 to-green-600 text-white rounded-xl hover:from-green-600 hover:to-green-700 font-medium shadow-lg shadow-green-500/25 transition-all">
                                <i class="fas fa-save mr-2"></i>Save Quiz
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- Quill Editor -->
    <script src="https://cdn.quilljs.com/1.3.6/quill.js"></script>

    <!-- Shared Utilities -->
    <script src="/js/shared/common-utils.js"></script>
    <script src="/js/shared/auth-utils.js"></script>
    <script src="/js/shared/api-utils.js"></script>

    <!-- Page Script -->
    <script src="/js/pages/lesson-management.js"></script>

    <%- include('../partials/footer') %>
</body>
</html>
